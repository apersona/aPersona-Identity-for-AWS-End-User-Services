var T=Object.create;var o=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var v=(e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})},u=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of w(t))!b.call(e,n)&&n!==r&&o(e,n,{get:()=>t[n],enumerable:!(s=k(t,n))||s.enumerable});return e};var D=(e,t,r)=>(r=e!=null?T(N(e)):{},u(t||!e||!e.__esModule?o(r,"default",{value:e,enumerable:!0}):r,e)),R=e=>u(o({},"__esModule",{value:!0}),e);var C={};v(C,{getResData:()=>x,getSecretKey:()=>I,getTotp:()=>S});module.exports=R(C);var m=require("@aws-sdk/client-dynamodb");var a=require("@aws-sdk/client-secrets-manager"),A=new a.SecretsManagerClient({region:process.env.AWS_REGION}),l=async()=>{let e=await A.send(new a.GetSecretValueCommand({SecretId:`amfa/${process.env.TENANT_ID}/secret`,VersionStage:"AWSCURRENT"}));return JSON.parse(e.SecretString)};var d=D(require("crypto"),1),E=({toDecrypt:e,aesKey:t})=>{let r=d.createDecipheriv("aes-128-ecb",t,"");return r.update(e,"base64","utf8")+r.final("utf8")},i=async(e,t,r)=>{let s={TableName:process.env.TOTPTOKEN_TABLE,Key:{id:{S:e.trim()+"#"+t?.trim()}}},n=await r.send(new m.GetItemCommand(s));console.log("get totp token result",n);let c=n.Item;return c&&c.token?{token:c.token.S,device_name:c.device_name.S,email:e}:null},I=async(e,t)=>{let{email:r,pid:s}=e,n=await i(r,s,t);if(console.log("totpTokenDB readResult",n),n){let c=n.token,p=await l(),_=p?.Mobile_Token_Key,g=p?.Mobile_Token_Salt,y=`${_}${g}`+r.substring(0,r.length/2),f=Buffer.from(y,"utf8").toString("base64").substring(0,16);return E({toDecrypt:c,aesKey:f})}return null},S=async(e,t,r)=>(await i(e,t,r))?.device_name,x=async(e,t,r)=>{switch(r){case"n":return await S(e.email,e.pid,t);case"c":return await i(e.email,e.pid,t);default:break}return null};0&&(module.exports={getResData,getSecretKey,getTotp});
//# sourceMappingURL=get.js.map
